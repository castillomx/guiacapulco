<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gu√≠aAca Pro - Directorio de Comercios</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #0f172a; scroll-behavior: smooth; }
        :root { --midnight-blue: #0f172a; --elegant-gold: #c5a059; --whatsapp-green: #25D366; --qr-brown: #8b5e3c; }
        .gradient-header { background: linear-gradient(rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.7)), url('https://images.unsplash.com/photo-1589828914726-278438e35074?q=80&w=1920'); background-size: cover; background-position: center; min-height: 600px; }
        .business-card { background: white; border-radius: 24px; border: 1px solid #e2e8f0; transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); position: relative; overflow: hidden; display: flex; flex-direction: column; }
        .business-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px -15px rgba(15, 23, 42, 0.1); border-color: var(--elegant-gold); }
        .business-desc { font-size: 0.9rem; line-height: 1.6; color: #475569; min-height: 80px; margin-bottom: 1rem; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
        .comment-box { background: #f8fafc; border-radius: 12px; padding: 10px; margin-top: 8px; font-size: 0.8rem; border-left: 3px solid var(--elegant-gold); }
        .btn-category { transition: all 0.3s ease; text-transform: uppercase; font-size: 0.65rem; font-weight: 800; letter-spacing: 1px; border-radius: 12px; }
        .weather-badge { background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; }
    </style>
</head>
<body>

    <div id="modalQR" class="fixed inset-0 z-[500] hidden flex items-center justify-center p-6 bg-slate-900/95 backdrop-blur-md">
        <div class="bg-white w-full max-w-xs rounded-[2rem] p-10 text-center shadow-2xl text-black">
            <h3 id="qrNombre" class="text-xl font-bold mb-4 uppercase">Negocio</h3>
            <div class="bg-slate-50 p-4 rounded-2xl mb-8"><img id="qrImagen" src="" alt="QR" class="w-44 h-44 mx-auto"></div>
            <button onclick="cerrarQR()" class="w-full py-4 bg-slate-900 text-white rounded-xl font-bold uppercase tracking-widest">Cerrar</button>
        </div>
    </div>

    <div id="modalNuevoClasificado" class="fixed inset-0 z-[500] hidden flex items-center justify-center p-6 bg-slate-900/90 backdrop-blur-sm text-black">
        <div class="bg-white w-full max-w-md rounded-[2rem] p-8 shadow-2xl">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold uppercase tracking-tight">Publicar Clasificado</h3>
                <button onclick="cerrarModalClasificado()" class="text-slate-400 hover:text-slate-900 text-2xl">√ó</button>
            </div>
            <form id="formClasificado" class="space-y-4">
                <input type="text" id="claNombre" placeholder="Nombre del Prestador" class="w-full p-3 border rounded-xl outline-none" required>
                <input type="text" id="claOficio" placeholder="Oficio (ej. Carpintero, T√©cnico)" class="w-full p-3 border rounded-xl outline-none" required>
                <textarea id="claDesc" placeholder="Describe tus servicios..." class="w-full p-3 border rounded-xl outline-none h-24" required></textarea>
                <input type="tel" id="claTel" placeholder="WhatsApp (10 d√≠gitos)" class="w-full p-3 border rounded-xl outline-none" required>
                <button type="submit" class="w-full py-4 bg-purple-700 text-white rounded-xl font-bold uppercase shadow-lg hover:bg-purple-800 transition-all text-xs">Publicar en la Nube</button>
            </form>
        </div>
    </div>

    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 px-8 py-4 flex justify-between items-center text-black">
        <div class="flex items-center gap-3">
            <div class="bg-slate-900 p-2 rounded-lg text-white"><i class="fas fa-briefcase"></i></div>
            <span class="text-xl font-black uppercase">Gu√≠a<span class="text-blue-600">Aca</span> Pro</span>
        </div>
        <div class="flex items-center gap-4">
            <button id="loginBtn" onclick="simularLogin()" class="text-[10px] font-bold uppercase border-2 border-slate-200 px-4 py-2 rounded-lg hover:bg-slate-50 transition-all"><i class="fab fa-google mr-2"></i> Acceder</button>
            <a href="https://forms.gle/LekeLGcuVmXxix8VA" target="_blank" class="bg-slate-900 text-white px-5 py-2.5 rounded-xl font-bold text-[10px] uppercase shadow-md transition-all">+ Registrar Negocio</a>
        </div>
    </nav>

    <header class="gradient-header flex flex-col items-center justify-center px-6 py-12 text-center text-white relative">
        <div class="inline-flex items-center gap-4 weather-badge px-4 py-2 mb-8 mx-auto">
            <div class="flex items-center gap-2 text-white"><i class="fas fa-calendar-day text-amber-400 text-xs"></i><p id="fechaText" class="text-[9px] font-bold uppercase">Cargando...</p></div>
            <div class="h-3 w-[1px] bg-white/20"></div>
            <div class="flex items-center gap-2 text-white"><i class="fas fa-sun text-amber-400 text-xs"></i><p class="text-[9px] font-bold uppercase">32¬∞C Soleado</p></div>
        </div>

        <h1 class="text-4xl md:text-6xl font-extrabold mb-10 italic uppercase drop-shadow-2xl">Directorio <span class="text-amber-400">Inteligente</span> Acapulco</h1>

        <div class="flex flex-wrap justify-center gap-3 mb-10 max-w-4xl mx-auto">
            <button onclick="filtrarPorCategoria('Asesor√≠a Contable')" class="btn-category px-5 py-3 bg-blue-700 text-white shadow-lg hover:bg-blue-800">üìë Fiscal</button>
            <button onclick="filtrarPorCategoria('Gastronom√≠a')" class="btn-category px-5 py-3 bg-orange-500 text-white shadow-lg hover:bg-orange-600">ü•ò Comida</button>
            <button onclick="filtrarPorCategoria('Turismo')" class="btn-category px-5 py-3 bg-teal-600 text-white shadow-lg hover:bg-teal-700">üèùÔ∏è Turismo</button>
            <button onclick="filtrarPorCategoria('Comercio')" class="btn-category px-5 py-3 bg-slate-700 text-white shadow-lg hover:bg-slate-800">üõçÔ∏è Comercio</button>
            <button onclick="filtrarPorCategoria('Decoraci√≥n y Eventos Sociales')" class="btn-category px-5 py-3 bg-rose-500 text-white shadow-lg hover:bg-rose-600">üéà Eventos</button>
            <button onclick="abrirModalClasificado()" class="btn-category px-5 py-3 bg-purple-700 text-white animate-pulse shadow-lg"><i class="fas fa-plus mr-2"></i> Nuevo Clasificado</button>
        </div>

        <div class="relative w-full max-w-5xl mx-auto mb-10 text-black px-4">
            <input type="text" id="inputBusqueda" placeholder="Busca oficios, comida, zonas o servicios en Acapulco..." 
                   class="w-full py-6 px-16 rounded-2xl bg-white text-slate-900 shadow-2xl outline-none focus:ring-4 focus:ring-blue-500/30 text-lg md:text-xl font-medium placeholder:text-slate-400">
            <i class="fas fa-search absolute left-10 top-1/2 -translate-y-1/2 text-slate-400 text-2xl"></i>
        </div>

        <div class="flex justify-center gap-4">
            <button onclick="mostrarNegocios(negocios)" class="bg-white/10 hover:bg-white/20 backdrop-blur-md text-white border border-white/30 px-8 py-3 rounded-xl font-bold text-[10px] uppercase transition-all">Ver Todo</button>
            <button onclick="verClasificados()" class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-bold text-[10px] uppercase shadow-lg transition-all"><i class="fas fa-bullhorn mr-2"></i> Clasificados</button>
        </div>
    </header>

    <main class="max-w-7xl mx-auto -mt-16 px-8 pb-20 relative z-20">
        <div class="flex flex-col md:flex-row justify-between items-center gap-6 mb-12">
            <h2 id="currentFilterText" class="bg-slate-900 text-white px-10 py-3 rounded-xl shadow-2xl text-[10px] font-black uppercase tracking-[3px] italic">Resultados Destacados</h2>
        </div>
        <div id="contenedorNegocios" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10"></div>
    </main>

    <script type="module">
        // (Tu configuraci√≥n de Firebase se mantiene igual aqu√≠)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCuuDqnjhVBzfswb8eU2GhPEBNK4a0god8",
            authDomain: "directorioacapulco.firebaseapp.com",
            projectId: "directorioacapulco",
            storageBucket: "directorioacapulco.firebasestorage.app",
            messagingSenderId: "360656438922",
            appId: "1:360656438922:web:191cb7742202763c118f73"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db; window.collection = collection; window.addDoc = addDoc;

        onSnapshot(query(collection(db, "comentarios"), orderBy("fecha", "asc")), (snap) => {
            let tempComms = {};
            snap.forEach(doc => {
                const data = doc.data();
                if (!tempComms[data.negocioId]) tempComms[data.negocioId] = [];
                tempComms[data.negocioId].push(data);
            });
            window.comentariosDB = tempComms;
            if(window.mostrarNegocios) window.mostrarNegocios(window.negociosActuales || window.negocios);
        });

        onSnapshot(query(collection(db, "clasificados"), orderBy("fecha", "desc")), (snap) => {
            window.listaClasificadosRealTime = snap.docs.map(doc => ({id: doc.id, ...doc.data()}));
        });
    </script>

    <script>
        const negocios = [
            { id: 1, nombre: "Decoraciones Ana Lizbeth", categoria: "Decoraci√≥n y Eventos Sociales", descripcion: "Globos, eventos sociales, desayunos sorpresa.", zona: "Rinconada Luis Donaldo Colosio", tel: "7442211689", img: "img/analizbeth.jpg" },
            { id: 2, nombre: "Papeler√≠a Paty", categoria: "Comercio", descripcion: "Art√≠culos de papeler√≠a, impresiones, copias.", zona: "Granjas del Marqu√©s", tel: "7444433601", img: "img/papepaty.jpg" },
            { id: 3, nombre: "Peluquer√≠a Mercado", categoria: "Comercio", descripcion: "Cortes de cabello para toda la Familia", zona: "M√°rtires de La Democracia", tel: "0", img: "img/peluquero.jpg" },
            // NEGOCIO ACTUALIZADO: Ahora aparece en Comida y Comercio
            { id: 4, nombre: "Venta de Jugos Naturales", categoria: "Gastronom√≠a, Comercio", descripcion: "Jugo de naranja reci√©n exprimido.", zona: "Av. Principal Colosio", tel: "0", img: "img/jugos.jpg" },
            { id: 5, nombre: "Asesor√≠as Contables", categoria: "Asesor√≠a Contable", descripcion: "Tr√°mites ante el SAT y contabilidad.", zona: "Costa Azul, Acapulco.", tel: "7445315790", img: "img/contable.jpg" }
        ];

        window.negocios = negocios;
        window.comentariosDB = {};

        function mostrarNegocios(lista, label = "Resultados") {
            window.negociosActuales = lista;
            const contenedor = document.getElementById('contenedorNegocios');
            contenedor.innerHTML = '';
            document.getElementById('currentFilterText').innerText = label;
            
            lista.forEach(n => {
                const listadoComms = window.comentariosDB[n.id || n.nombre] || [];
                const hasWA = n.tel && n.tel !== "0";
                contenedor.innerHTML += `
                    <article class="business-card text-black">
                        <div class="h-48 overflow-hidden bg-slate-100"><img src="${n.img}" class="w-full h-full object-cover" onerror="this.src='https://images.unsplash.com/photo-1521791136064-7986c2920216?q=80&w=400'"></div>
                        <div class="p-6 flex flex-col flex-grow bg-white">
                            <span class="text-[8px] font-bold uppercase text-slate-500 bg-slate-100 px-2 py-1 rounded w-fit mb-3">${n.categoria}</span>
                            <h3 class="text-lg font-extrabold mb-2 uppercase leading-tight">${n.nombre}</h3>
                            <p class="business-desc italic">${n.descripcion}</p>
                            <div class="flex items-center gap-2 text-slate-400 text-[10px] mb-4"><i class="fas fa-map-marker-alt text-amber-600"></i><span>${n.zona}</span></div>
                            <div class="grid grid-cols-2 gap-2 mb-4 text-white">
                                ${hasWA ? `<a href="https://wa.me/52${n.tel}" target="_blank" class="bg-[#25D366] py-2 rounded-lg font-bold text-[9px] text-center uppercase">WhatsApp</a>` : '<span class="bg-slate-100 text-slate-400 py-2 rounded-lg font-bold text-[9px] text-center">Sin Tel</span>'}
                                <button onclick="generarQR('${n.tel}', '${n.nombre}')" class="bg-[#8b5e3c] py-2 rounded-lg font-bold text-[9px] uppercase">QR</button>
                            </div>
                        </div>
                    </article>`;
            });
        }

        // FUNCI√ìN DE FILTRO MEJORADA (Usa .includes para que un negocio pueda estar en varias categor√≠as)
        window.filtrarPorCategoria = (c) => {
            const res = negocios.filter(n => n.categoria.toLowerCase().includes(c.toLowerCase()));
            mostrarNegocios(res, c);
        };

        document.getElementById('inputBusqueda').addEventListener('input', (e) => {
            const b = e.target.value.toLowerCase();
            if (!b) { mostrarNegocios(negocios); return; }
            const pool = [...negocios, ...(window.listaClasificadosRealTime || [])];
            const res = pool.filter(n => `${n.nombre} ${n.descripcion} ${n.zona} ${n.categoria}`.toLowerCase().includes(b));
            mostrarNegocios(res, `Buscando: "${b}"`);
        });

        window.abrirModalClasificado = () => document.getElementById('modalNuevoClasificado').classList.remove('hidden');
        window.cerrarModalClasificado = () => document.getElementById('modalNuevoClasificado').classList.add('hidden');
        function generarQR(t, n) { document.getElementById('qrImagen').src = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent('https://wa.me/52'+t)}`; document.getElementById('qrNombre').innerText = n; document.getElementById('modalQR').classList.remove('hidden'); }
        function cerrarQR() { document.getElementById('modalQR').classList.add('hidden'); }
        document.getElementById('fechaText').innerText = new Date().toLocaleDateString('es-MX', { day: 'numeric', month: 'short', year: 'numeric' });
        
        mostrarNegocios(negocios);
    </script>
</body>
</html>
