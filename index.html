<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Directorio de Comercios en Acapulco</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #0f172a; scroll-behavior: smooth; }
        :root { --midnight-blue: #0f172a; --elegant-gold: #c5a059; --whatsapp-green: #25D366; --qr-brown: #8b5e3c; }

        .gradient-header {
            background: linear-gradient(rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.7)),
                        url('https://images.unsplash.com/photo-1589828914726-278438e35074?q=80&w=1920');
            background-size: cover; background-position: center; min-height: 650px;
        }

        .business-card {
            background: white; border-radius: 24px; border: 1px solid #e2e8f0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            position: relative; overflow: hidden; display: flex; flex-direction: column;
        }
        .business-card:hover { transform: translateY(-8px); box-shadow: 0 20px 40px -15px rgba(15, 23, 42, 0.1); border-color: var(--elegant-gold); }

        .business-desc {
            font-size: 0.95rem; line-height: 1.7; color: #334155;
            min-height: 95px; margin-bottom: 2rem;
            display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; overflow: hidden;
        }

        .weather-badge {
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 15px;
        }

        .btn-category {
            transition: all 0.3s ease; text-transform: uppercase;
            font-size: 0.65rem; font-weight: 800; letter-spacing: 1px;
            border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        .btn-category:hover { transform: translateY(-3px) scale(1.05); filter: brightness(1.1); }
    </style>
</head>
<body>

    <div id="modalQR" class="fixed inset-0 z-[500] hidden flex items-center justify-center p-6 bg-slate-900/95 backdrop-blur-md text-black text-black">
        <div class="bg-white w-full max-w-xs rounded-[2rem] p-10 text-center shadow-2xl border-2 border-slate-100">
            <h3 id="qrNombre" class="text-xl font-bold text-slate-900 mb-4 uppercase">Negocio</h3>
            <div class="bg-slate-50 p-6 rounded-2xl inline-block mb-8 border border-slate-100 text-black"><img id="qrImagen" src="" alt="QR" class="w-44 h-44 mx-auto text-black text-black"></div>
            <button onclick="cerrarQR()" class="w-full py-4 bg-slate-900 text-white rounded-xl font-bold text-sm uppercase tracking-widest">Cerrar</button>
        </div>
    </div>

    <div id="modalNuevoClasificado" class="fixed inset-0 z-[500] hidden flex items-center justify-center p-6 bg-slate-900/90 backdrop-blur-sm text-black text-black">
        <div class="bg-white w-full max-w-md rounded-[2rem] p-8 shadow-2xl border-2 border-slate-100 text-black">
            <div class="flex justify-between items-center mb-6 text-black">
                <h3 class="text-xl font-bold text-slate-900 uppercase">Anuncio Clasificado</h3>
                <button onclick="cerrarModalClasificado()" class="text-slate-400 hover:text-slate-900"><i class="fas fa-times text-xl"></i></button>
            </div>
            <form id="formClasificado" class="space-y-4 text-black">
                <input type="text" id="claNombre" placeholder="Nombre del Prestador u Oficio" class="w-full p-3 border rounded-xl outline-none text-black" required>
                <input type="text" id="claOficio" placeholder="Categor√≠a (ej. Carpintero, Plomero)" class="w-full p-3 border rounded-xl outline-none text-black" required>
                <textarea id="claDesc" placeholder="Descripci√≥n de tus servicios..." class="w-full p-3 border rounded-xl outline-none h-24 text-black" required></textarea>
                <input type="tel" id="claTel" placeholder="WhatsApp (10 d√≠gitos)" class="w-full p-3 border rounded-xl outline-none text-black" required>
                <button type="submit" class="w-full py-4 bg-purple-700 text-white rounded-xl font-bold uppercase text-xs shadow-lg hover:bg-purple-800 transition-all">Publicar en la Nube</button>
            </form>
        </div>
    </div>

    <nav class="bg-white border-b border-slate-200 sticky top-0 z-50 px-8 py-4">
        <div class="max-w-7xl mx-auto flex justify-between items-center text-black">
            <div class="flex items-center gap-3">
                <div class="bg-slate-900 p-2 rounded-lg text-white"><i class="fas fa-briefcase"></i></div>
                <span class="text-xl font-black text-slate-900 uppercase">Gu√≠a<span class="text-blue-600">Aca</span> Pro</span>
            </div>
            <a href="https://forms.gle/LekeLGcuVmXxix8VA" target="_blank" class="bg-slate-900 hover:bg-blue-800 text-white px-6 py-2.5 rounded-xl font-bold text-[10px] uppercase shadow-md transition-all">+ Registrar Mi Negocio</a>
        </div>
    </nav>

    <header class="gradient-header flex flex-col items-center justify-center px-6 py-12 text-center text-white relative">
        <div class="max-w-5xl w-full">
            <div class="inline-flex flex-wrap justify-center items-center gap-6 weather-badge px-5 py-2 mb-10 mx-auto">
                <div class="flex items-center gap-3 text-white"><i class="fas fa-calendar-day text-amber-400"></i><p id="fechaText" class="text-[10px] font-bold uppercase">Cargando...</p></div>
                <div class="h-3 w-[1px] bg-white/20 hidden md:block"></div>
                <div class="flex items-center gap-3 text-white"><i class="fas fa-sun text-amber-400 text-base"></i><p class="text-[10px] font-bold uppercase">30¬∞C Soleado</p></div>
            </div>

            <h1 class="text-4xl md:text-6xl font-extrabold mb-10 italic uppercase tracking-tighter leading-tight drop-shadow-xl">Directorio Inteligente <span class="text-amber-400">Acapulco</span></h1>

            <div class="flex flex-wrap justify-center gap-3 mb-10 text-white">
                <button onclick="filtrarPorCategoria('Asesor√≠a Contable')" class="btn-category px-6 py-3 bg-blue-700 text-white">üìë Fiscal</button>
                <button onclick="filtrarPorCategoria('Gastronom√≠a')" class="btn-category px-6 py-3 bg-orange-500 text-white">ü•ò Comida</button>
                <button onclick="filtrarPorCategoria('Turismo')" class="btn-category px-6 py-3 bg-teal-600 text-white">üèùÔ∏è Turismo</button>
                <button onclick="filtrarPorCategoria('Comercio')" class="btn-category px-6 py-3 bg-emerald-600 text-white">üõçÔ∏è Comercio</button>
                <button onclick="abrirModalClasificado()" class="btn-category px-6 py-3 bg-purple-700 text-white animate-pulse"><i class="fas fa-plus mr-2"></i> Nuevo Clasificado</button>
            </div>
            
            <div class="relative max-w-2xl mx-auto mb-10 text-black">
                <input type="text" id="inputBusqueda" placeholder="Busca oficios, comida, CP o cualquier palabra..." class="w-full py-5 px-14 rounded-2xl bg-white text-slate-900 shadow-2xl outline-none focus:ring-4 focus:ring-blue-500/30 text-base transition-all">
                <i class="fas fa-search absolute left-5 top-1/2 -translate-y-1/2 text-slate-400 text-xl text-black"></i>
            </div>

            <div class="flex justify-center gap-4">
                <button onclick="mostrarNegocios(negocios)" class="bg-white/10 hover:bg-white/20 backdrop-blur-md text-white border border-white/30 px-8 py-3 rounded-xl font-bold text-[10px] uppercase transition-all">Ver Directorio</button>
                <button onclick="verClasificados()" class="bg-purple-600 hover:bg-purple-700 text-white px-8 py-3 rounded-xl font-bold text-[10px] uppercase shadow-lg transition-all"><i class="fas fa-bullhorn mr-2"></i> Ver Clasificados</button>
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto -mt-16 px-8 pb-20 relative z-20 text-black text-black">
        <div class="flex flex-col md:flex-row justify-between items-center gap-6 mb-12">
            <h2 id="currentFilterText" class="bg-slate-900 text-white px-10 py-3 rounded-xl shadow-2xl text-[10px] font-black uppercase tracking-[3px] italic">Resultados</h2>
            
            <div class="flex flex-wrap justify-center gap-3">
                <button onclick="window.open('img/mapa.jpg', '_blank')" class="px-6 py-3 bg-sky-700 text-white rounded-xl font-bold text-[9px] uppercase shadow-xl hover:bg-sky-800 transition-all flex items-center gap-2">
                    <i class="fas fa-map"></i> Mapa Tur√≠stico (Imagen)
                </button>
                <button onclick="window.open('https://www.google.com/maps/search/$6', '_blank')" class="px-8 py-3 bg-amber-500 text-white rounded-xl font-bold text-[9px] uppercase shadow-xl hover:bg-amber-600 transition-all flex items-center gap-2 text-black">
                    <i class="fas fa-location-dot"></i> Playas y Sitios de Inter√©s
                </button>
            </div>
        </div>
        <div id="contenedorNegocios" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-10 text-black"></div>
    </main>

    <footer class="bg-slate-950 py-12 text-center border-t-4 border-amber-500 text-white">
        <p class="font-bold text-xs uppercase tracking-[4px] mb-2 text-white">¬© 2026 Directorio de Comercios en Acapulco</p>
    </footer>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyCuuDqnjhVBzfswb8eU2GhPEBNK4a0god8",
          authDomain: "directorioacapulco.firebaseapp.com",
          projectId: "directorioacapulco",
          storageBucket: "directorioacapulco.firebasestorage.app",
          messagingSenderId: "360656438922",
          appId: "1:360656438922:web:191cb7742202763c118f73"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        window.db = db;
        window.collection = collection;
        window.addDoc = addDoc;

        // Escuchar clasificados en tiempo real
        onSnapshot(query(collection(db, "clasificados"), orderBy("fecha", "desc")), (snapshot) => {
            let reales = [];
            snapshot.forEach((doc) => reales.push({ id: doc.id, ...doc.data() }));
            window.listaClasificadosRealTime = reales;
        });

        // Evento para el formulario
        document.getElementById('formClasificado').addEventListener('submit', async (e) => {
            e.preventDefault();
            const nuevo = {
                nombre: document.getElementById('claNombre').value,
                categoria: document.getElementById('claOficio').value,
                descripcion: document.getElementById('claDesc').value,
                tel: document.getElementById('claTel').value,
                zona: "Servicio a Domicilio",
                img: "https://images.unsplash.com/photo-1581578731522-745d051422c1?q=80&w=400",
                fecha: new Date(),
                esClasificado: true
            };
            try {
                await addDoc(collection(db, "clasificados"), nuevo);
                alert("¬°Anuncio publicado globalmente!");
                window.cerrarModalClasificado();
                e.target.reset();
            } catch (err) { console.error(err); }
        });
    </script>

    <script>
        const diccionarioRelaciones = {
            "comida": ["gastronom√≠a", "jugos", "restaurante", "cenadur√≠a", "naranja", "fruta", "desayunos"],
            "contador": ["fiscal", "asesor√≠a", "sat", "impuestos", "contabilidad", "contable"],
            "oficios": ["carpintero", "alba√±il", "electricista", "plomero", "pintor", "herrero"]
        };

        const negocios = [
            { nombre: "Decoraciones Ana Lizbeth", categoria: "Decoraci√≥n y Eventos Sociales", descripcion: "Globos, eventos sociales, desayunos sorpresa.", zona: "Rinconada Luis Donaldo Colosio", cp: "39890", tel: "7442211689", img: "img/analizbeth.jpg" },
            { nombre: "Papeler√≠a Paty", categoria: "Comercio", descripcion: "Art√≠culos de papeler√≠a, impresiones, copias.", zona: "Granjas del Marqu√©s", cp: "39890", tel: "7444433601", img: "img/papepaty.jpg" },
            { nombre: "Peluquer√≠a Mercado", categoria: "Comercio", descripcion: "Cortes de cabello para toda la Familia", zona: "M√°rtires de La Democracia", cp: "39890", tel: "0", img: "img/peluquero.jpg" },
            { nombre: "Venta de Jugos Naturales", categoria: "Comercio", descripcion: "Jugo de naranja reci√©n exprimido.", zona: "Av. Principal Colosio", cp: "39890", tel: "0", img: "img/jugos.jpg" }
        ];

        function mostrarNegocios(lista, label = "Negocios Destacados") {
            const contenedor = document.getElementById('contenedorNegocios');
            contenedor.innerHTML = '';
            document.getElementById('currentFilterText').innerText = label;
            
            lista.forEach(n => {
                const hasWA = n.tel && n.tel !== "0";
                const qMap = `https://www.google.com/maps/search/$7{encodeURIComponent(n.nombre + ' ' + (n.zona || 'Acapulco'))}`;
                
                contenedor.innerHTML += `
                    <article class="business-card text-black shadow-sm">
                        <div class="h-52 overflow-hidden bg-slate-100 text-black"><img src="${n.img}" class="w-full h-full object-cover"></div>
                        <div class="p-8 flex flex-col flex-grow bg-white text-black">
                            <div class="mb-4"><span class="text-[9px] font-bold uppercase text-slate-500 bg-slate-100 px-3 py-1 rounded-lg border">${n.categoria}</span></div>
                            <h3 class="text-xl font-extrabold mb-3 italic text-slate-900 uppercase">${n.nombre}</h3>
                            <p class="business-desc italic text-slate-600 text-black">${n.descripcion}</p>
                            <div class="flex items-center gap-3 text-slate-400 text-[10px] font-bold uppercase mb-8 border-b border-slate-50 pb-4">
                                <i class="fas fa-map-marker-alt text-amber-600"></i><span>${n.zona}</span>
                            </div>
                            <div class="mt-auto grid grid-cols-1 gap-3">
                                <div class="grid grid-cols-2 gap-3 text-white">
                                    ${hasWA ? `<a href="https://wa.me/52${n.tel}" target="_blank" class="bg-[#25D366] text-white py-4 rounded-xl font-bold text-[9px] uppercase text-center flex items-center justify-center gap-2"><i class="fab fa-whatsapp"></i> WhatsApp</a>` : '<span class="bg-slate-100 text-slate-400 py-4 rounded-xl font-bold text-[9px] text-center">Sin Tel</span>'}
                                    <button onclick="generarQR('${n.tel}', '${n.nombre}')" class="bg-[#8b5e3c] text-white py-4 rounded-xl font-bold text-[9px] uppercase">QR</button>
                                </div>
                                ${!n.esClasificado ? `<a href="${qMap}" target="_blank" class="w-full bg-slate-900 text-white py-4 rounded-xl font-bold text-[10px] uppercase text-center block shadow-2xl">Ver Ubicaci√≥n Exacta</a>` : `<div class="w-full bg-purple-100 text-purple-700 py-4 rounded-xl font-bold text-[10px] text-center"><i class="fas fa-home mr-2"></i> Servicio a Domicilio</div>`}
                            </div>
                        </div>
                    </article>`;
            });
        }

        // BUSCADOR MEJORADO
        document.getElementById('inputBusqueda').addEventListener('input', (e) => {
            const b = e.target.value.toLowerCase();
            if (!b) { mostrarNegocios(negocios); return; }
            const pool = [...negocios, ...(window.listaClasificadosRealTime || [])];
            const res = pool.filter(n => {
                const campos = `${n.nombre} ${n.descripcion} ${n.zona} ${n.categoria} ${n.cp || ''}`.toLowerCase();
                if (campos.includes(b)) return true;
                for (const [clave, sinonimos] of Object.entries(diccionarioRelaciones)) {
                    if (clave.includes(b) || sinonimos.some(s => s.includes(b))) {
                        if (sinonimos.some(s => campos.includes(s)) || n.categoria.toLowerCase().includes(clave)) return true;
                    }
                }
                return false;
            });
            mostrarNegocios(res, `Buscando: "${b}"`);
        });

        window.abrirModalClasificado = () => document.getElementById('modalNuevoClasificado').classList.remove('hidden');
        window.cerrarModalClasificado = () => document.getElementById('modalNuevoClasificado').classList.add('hidden');
        window.verClasificados = () => mostrarNegocios(window.listaClasificadosRealTime || [], "Anuncios Clasificados Reales");
        window.filtrarPorCategoria = (c) => mostrarNegocios(negocios.filter(n => n.categoria === c), c);
        function generarQR(t, n) { document.getElementById('qrImagen').src = `https://api.qrserver.com/v1/create-qr-code/?size=250x250&data=${encodeURIComponent('https://wa.me/52'+t)}`; document.getElementById('qrNombre').innerText = n; document.getElementById('modalQR').classList.remove('hidden'); }
        function cerrarQR() { document.getElementById('modalQR').classList.add('hidden'); }
        function actualizarPulso() { document.getElementById('fechaText').innerText = new Date().toLocaleDateString('es-MX', { day: 'numeric', month: 'short', year: 'numeric' }); }

        actualizarPulso();
        mostrarNegocios(negocios);
    </script>
</body>
</html>
